modules:
  - type: dnf
    repos:
      cleanup: true
      files:
        - https://packages.microsoft.com/yumrepos/vscode/config.repo
        - https://download.docker.com/linux/fedora/docker-ce.repo
      copr:
        - ublue-os/packages
    install:
      packages:
        - repo: copr:copr.fedorainfracloud.org:ublue-os:packages
          packages:
            - ublue-setup-services
        - repo: vscode-yum
          packages:
            - code
        - repo: docker-ce-stable
          packages:
            - containerd.io
            - docker-buildx-plugin
            - docker-ce
            - docker-ce-cli
            - docker-compose-plugin
        - android-tools
        - bcc
        - bpftop
        - bpftrace
        - flatpak-builder
        - ccache
        - nicstat
        - numactl
        - podman-machine
        - podman-tui
        - python3-ramalama
        - qemu-kvm
        - restic
        - rclone
        - sysprof
        - tiptop
        - usbmuxd
        - zsh
        - libcgroup
  
  - type: files
    files:
      - source: system
        destination: /

  - type: systemd
    system:
      enabled:
        - docker.socket
        - podman.socket
        - ublue-system-setup.service
    user:
      enabled:
        - ublue-user-setup.service

  - type: script
    snippets:
      - "echo 'import \"/usr/share/ublue-os/just/95-bazzite-dx.just\"' >> /usr/share/ublue-os/justfile"
      - "dnf5 clean all"
      - "rm -rf /tmp/* || true"
      - "rm -rf /var || true"
      - "mkdir -p /var"
      - "bootc container lint || true"
